<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æœ€å°‘éŒ¢å¹£ä»˜æ¬¾å°éŠæˆ²</title>
  <style>
    @font-face {
      font-family: "BpmfZihiKaiStd";
      src: url("BpmfZihiKaiStd-Regular.ttf") format("truetype");
      font-weight: normal;
      font-style: normal;
    }

    * {
      box-sizing: border-box;
      font-family: "BpmfZihiKaiStd", "Noto Sans TC", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: #f3f4f6;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    /* ruby æ³¨éŸ³æ¨£å¼ */
    ruby {
      ruby-position: over;
    }

    rt {
      font-size: 0.6em;
      line-height: 1;
      color: #6b7280;
    }

    .game-container {
      width: 960px;
      max-width: 100%;
      height: 540px;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
      display: flex;
      overflow: hidden;
    }

    /* å·¦æ¬„ï¼šé¡Œç›®å€ï¼ˆç´„ 3 æˆï¼‰ */
    .left-panel {
      width: 30%;
      padding: 16px 20px 12px;
      border-right: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: space-between;
      gap: 8px;
      background: #f9fafb;
    }

    .question-number {
      font-size: 14px;
      color: #6b7280;
      text-align: center;
      margin-bottom: 4px;
    }

    .product-image {
      border-radius: 12px;
      background: #ffffff;
      border: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #1f2933;
      text-align: center;
      padding: 8px;
      min-height: 120px;
      max-height: 160px;
    }

    .product-emoji {
      font-size: 56px;
      line-height: 1;
    }

    .question-header {
      text-align: center;
      margin-top: 4px;
      margin-bottom: 4px;
    }

    .price-display {
      font-size: 28px;
      font-weight: 700;
      color: #111827;
      margin-bottom: 2px;
    }

    .price-display span.unit {
      font-size: 18px;
      margin-left: 4px;
      color: #4b5563;
    }

    .product-name {
      font-size: 16px;
      color: #374151;
    }

    .progress-info {
      font-size: 13px;
      color: #6b7280;
      text-align: center;
      padding-top: 4px;
      border-top: 1px dashed #e5e7eb;
      margin-top: 4px;
    }

    /* å³æ¬„ï¼šå››å€‹é¸é …ï¼ˆç´„ 7 æˆï¼‰ */
    .right-panel {
      width: 70%;
      padding: 20px;
      position: relative;
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    .options-grid {
      width: 100%;
      height: 100%;
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      gap: 16px;
      align-items: stretch;
      justify-items: stretch;
    }

    .option-card {
      background: #f9fafb;
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      padding: 14px 14px 12px;
      display: flex;
      flex-direction: column;
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease, border-color 0.12s ease, background 0.12s ease;
    }

    .option-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
      border-color: #3b82f6;
      background: #eff6ff;
    }

    .option-card.disabled {
      cursor: default;
      opacity: 0.6;
      box-shadow: none;
      transform: none;
    }

    .option-title {
      font-size: 15px;
      font-weight: 600;
      color: #4b5563;
      margin-bottom: 10px;
      text-align: center;
    }

    .option-body {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 6px;
    }

    .money-line {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 0;
    }

    .note-icon {
      min-width: 84px;
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      text-align: center;
      font-size: 15px;
      margin-right: 8px;
      background: #ffffff;
    }

    /* æŒ‡å®šé¡è‰²ï¼š
       1000 = è—ã€100 = ç´…ã€10 = éŠ€ã€1 = éŠ… */
    .note-1000 { background: #dbeafe; border-color: #93c5fd; } /* è— */
    .note-100  { background: #fecaca; border-color: #f87171; } /* ç´… */
    .note-10   { background: #e5e7eb; border-color: #9ca3af; } /* éŠ€ */
    .note-1    { background: #fed7aa; border-color: #f97316; } /* éŠ… */

    .note-multiplier {
      font-size: 16px;
      color: #374151;
    }

    .note-multiplier strong {
      font-weight: 700;
    }

    /* å‹¾å‹¾ / å‰å‰ æç¤º */
    .feedback-overlay {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.55);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.15s ease;
      z-index: 10;
    }

    .feedback-overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .feedback-circle {
      min-width: 260px;
      max-width: 320px;
      border-radius: 24px;
      background: #ffffff;
      padding: 18px 24px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
      animation: pop 0.25s ease-out;
      text-align: center;
    }

    .feedback-icon {
      width: 72px;
      height: 72px;
      border-radius: 999px;
      border: 3px solid currentColor;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      margin-bottom: 10px;
    }

    .feedback-text {
      font-size: 18px;
      font-weight: 600;
      color: #111827;
      margin-bottom: 4px;
    }

    .feedback-text-sub {
      font-size: 14px;
      color: #4b5563;
      line-height: 1.4;
    }

    @keyframes pop {
      from {
        transform: scale(0.8);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* çµæŸç•«é¢ */
    .end-screen {
      position: absolute;
      inset: 0;
      background: rgba(249, 250, 251, 0.98);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 20;
      text-align: center;
      padding: 20px;
    }

    .end-screen.visible {
      display: flex;
    }

    .end-title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
      color: #111827;
    }

    .end-subtitle {
      font-size: 16px;
      color: #4b5563;
      margin-bottom: 16px;
    }

    .end-score {
      font-size: 18px;
      color: #1f2937;
      margin-bottom: 20px;
    }

    .btn-restart {
      border: none;
      padding: 10px 20px;
      border-radius: 999px;
      background: #3b82f6;
      color: #ffffff;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.15s ease, transform 0.1s ease, box-shadow 0.1s ease;
      box-shadow: 0 6px 14px rgba(37, 99, 235, 0.4);
    }

    .btn-restart:hover {
      background: #2563eb;
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(37, 99, 235, 0.5);
    }

    .btn-restart:active {
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(37, 99, 235, 0.4);
    }

    @media (max-width: 768px) {
      .game-container {
        flex-direction: column;
        height: 640px;
      }
      .left-panel, .right-panel {
        width: 100%;
      }
      .left-panel {
        border-right: none;
        border-bottom: 1px solid #e5e7eb;
        height: 40%;
      }
      .right-panel {
        height: 60%;
      }
    }
  </style>
</head>
<body>
<div class="game-container">
  <!-- å·¦æ¬„ï¼šé¡Œè™Ÿ + åœ–ç‰‡ + åƒ¹æ ¼èˆ‡å“å -->
  <div class="left-panel">
    <div class="question-number" id="questionNumber"></div>

    <div class="product-image" id="productImage">
      <div class="product-emoji" id="productEmoji">ğŸ§¸</div>
    </div>

    <div class="question-header">
      <div class="price-display" id="priceDisplay"></div>
      <div class="product-name" id="productName"></div>
    </div>

    <div class="progress-info" id="progressInfo"></div>
  </div>

  <!-- å³æ¬„ï¼šå››å€‹é¸é … -->
  <div class="right-panel">
    <div class="options-grid" id="optionsGrid">
      <!-- é¸é …ç”± JS å‹•æ…‹ç”¢ç”Ÿ -->
    </div>

    <!-- å‹¾å‹¾ / å‰å‰ æç¤º -->
    <div class="feedback-overlay" id="feedbackOverlay">
      <div class="feedback-circle">
        <div class="feedback-icon" id="feedbackIcon">âœ“</div>
        <div class="feedback-text" id="feedbackText"></div>
        <div class="feedback-text-sub" id="feedbackSubText"></div>
      </div>
    </div>

    <!-- çµæŸç•«é¢ -->
    <div class="end-screen" id="endScreen">
      <div class="end-title" id="endTitle"></div>
      <div class="end-subtitle" id="endSubtitle"></div>
      <div class="end-score" id="endScore"></div>
      <button class="btn-restart" id="restartBtn"></button>
    </div>
  </div>
</div>

<script>
  // ===== ruby æ³¨éŸ³æ¨¡æ¿ =====
  const RUBY = {
    // é¡Œè™Ÿ
    DI: "<ruby>ç¬¬<rt>ã„‰ã„§Ë‹</rt></ruby>",
    TI: "<ruby>é¡Œ<rt>ã„Šã„§ËŠ</rt></ruby>",
    GONG: "<ruby>å…±<rt>ã„ã„¨ã„¥Ë‹</rt></ruby>",
    // å–®ä½
    YUAN: "<ruby>å…ƒ<rt>ã„©ã„¢ËŠ</rt></ruby>",
    // é€²åº¦
    PROG_PREFIX: "<ruby>ç­”<rt>ã„‰ã„šËŠ</rt>å°<rt>ã„‰ã„¨ã„ŸË‹</rt>é¡Œ<rt>ã„Šã„§ËŠ</rt>æ•¸<rt>ã„•ã„¨Ë‹</rt></ruby>ï¼š",
    // ä»˜æ¬¾æ–¹å¼
    PAY_LABEL: "<ruby>ä»˜<rt>ã„ˆã„¨Ë‹</rt>æ¬¾<rt>ã„ã„¨ã„¢Ë‡</rt>æ–¹<rt>ã„ˆã„¤</rt>å¼<rt>ã„•Ë‹</rt></ruby>",
    // å›é¥‹æ–‡å­—
    ANSWER_OK: "<ruby>ç­”<rt>ã„‰ã„šËŠ</rt>å°<rt>ã„‰ã„¨ã„ŸË‹</rt>äº†<rt>Ë™ã„Œã„œ</rt></ruby>",
    ANSWER_BAD: "<ruby>å†<rt>ã„—ã„Ë‹</rt>æƒ³<rt>ã„’ã„§ã„¤Ë‡</rt>ä¸€<rt>ã„§</rt>æƒ³<rt>ã„’ã„§ã„¤Ë‡</rt></ruby>",
    SUB_NEXT: "<ruby>é€²<rt>ã„ã„§ã„£Ë‹</rt>å…¥<rt>ã„–ã„¨Ë‹</rt>ä¸‹<rt>ã„’ã„§ã„šË‹</rt>ä¸€<rt>ã„§</rt>é¡Œ<rt>ã„Šã„§ËŠ</rt></ruby>â€¦",
    SUB_RESULT: "<ruby>å³<rt>ã„ã„§ËŠ</rt>å°‡<rt>ã„ã„§ã„¤</rt>é¡¯<rt>ã„’ã„§ã„¢Ë‡</rt>ç¤º<rt>ã„•Ë‹</rt>çµ<rt>ã„ã„§ã„ËŠ</rt>æœ<rt>ã„ã„¨ã„›ËŠ</rt></ruby>â€¦",
    SUB_WRONG: "<ruby>é€™<rt>ã„“ã„œË‹</rt>å€‹<rt>Ë™ã„ã„œ</rt>ä¸<rt>ã„…ã„¨Ë‹</rt>æ˜¯<rt>ã„•Ë‹</rt>æœ€<rt>ã„—ã„¨ã„ŸË‹</rt>å°‘<rt>ã„•ã„ Ë‡</rt>éŒ¢<rt>ã„‘ã„§ã„¢ËŠ</rt>å¹£<rt>ã„…ã„§Ë‹</rt>çš„<rt>Ë™ã„‰ã„œ</rt>ä»˜<rt>ã„ˆã„¨Ë‹</rt>æ¬¾<rt>ã„ã„¨ã„¢Ë‡</rt>æ–¹<rt>ã„ˆã„¤</rt>å¼<rt>ã„•Ë‹</rt></ruby>ã€‚",
    // çµæŸç•«é¢
    END_TITLE: "<ruby>å…¨<rt>ã„‘ã„©ã„¢ËŠ</rt>éƒ¨<rt>ã„…ã„¨Ë‹</rt>é¡Œ<rt>ã„Šã„§ËŠ</rt>ç›®<rt>ã„‡ã„¨Ë‹</rt>å®Œ<rt>ã„¨ã„¢ËŠ</rt>æˆ<rt>ã„”ã„¥ËŠ</rt></ruby>",
    END_SUBTITLE: "<ruby>ä½ <rt>ã„‹ã„§Ë‡</rt>å·²<rt>ã„§Ë‡</rt>ç¶“<rt>ã„ã„§ã„¥</rt>å­¸<rt>ã„’ã„©ã„ËŠ</rt>æœƒ<rt>ã„ã„¨ã„ŸË‹</rt>å¦‚<rt>ã„–ã„¨ËŠ</rt>ä½•<rt>ã„ã„œËŠ</rt>ç”¨<rt>ã„©ã„¥Ë‹</rt>æœ€<rt>ã„—ã„¨ã„ŸË‹</rt>å°‘<rt>ã„•ã„ Ë‡</rt>çš„<rt>Ë™ã„‰ã„œ</rt>éŒ¢<rt>ã„‘ã„§ã„¢ËŠ</rt>å¹£<rt>ã„…ã„§Ë‹</rt>ä»˜<rt>ã„ˆã„¨Ë‹</rt>æ¬¾<rt>ã„ã„¨ã„¢Ë‡</rt></ruby>ã€‚",
    END_SCORE_MID: "<ruby>é¡Œ<rt>ã„Šã„§ËŠ</rt>ï¼Œ<rt>ï¼Œ</rt>ä½ <rt>ã„‹ã„§Ë‡</rt>ç­”<rt>ã„‰ã„šËŠ</rt>å°<rt>ã„‰ã„¨ã„ŸË‹</rt>äº†<rt>Ë™ã„Œã„œ</rt></ruby>",
    END_SCORE_TAIL: "<ruby>é¡Œ<rt>ã„Šã„§ËŠ</rt></ruby>ã€‚",
    // æŒ‰éˆ•
    RESTART: "<ruby>å†<rt>ã„—ã„Ë‹</rt>ç©<rt>ã„¨ã„¢ËŠ</rt>ä¸€<rt>ã„§</rt>æ¬¡<rt>ã„˜Ë‹</rt></ruby>"
  };

  // å•†å“åç¨±æ³¨éŸ³
  const PRODUCT_RUBY = {
    "ç©æœ¨çµ„åˆ": "<ruby>ç©<rt>ã„ã„§ËŠ</rt>æœ¨<rt>ã„‡ã„¨Ë‹</rt>çµ„<rt>ã„—ã„¨Ë‡</rt>åˆ<rt>ã„ã„œËŠ</rt></ruby>",
    "å°ç†Šç©å¶": "<ruby>å°<rt>ã„’ã„§ã„ Ë‡</rt>ç†Š<rt>ã„’ã„©ã„¥ËŠ</rt>ç©<rt>ã„¨ã„¢ËŠ</rt>å¶<rt>ã„¡Ë‡</rt></ruby>",
    "é™æ§æ©Ÿå™¨äºº": "<ruby>é™<rt>ã„§ã„ ËŠ</rt>æ§<rt>ã„ã„¨ã„¥Ë‹</rt>æ©Ÿ<rt>ã„ã„§</rt>å™¨<rt>ã„‘ã„§Ë‹</rt>äºº<rt>ã„–ã„£ËŠ</rt></ruby>",
    "é«˜éšéŠæˆ²ä¸»æ©Ÿ": "<ruby>é«˜<rt>ã„ã„ </rt>éš<rt>ã„ã„§ã„</rt>éŠ<rt>ã„§ã„¡ËŠ</rt>æˆ²<rt>ã„’ã„§Ë‹</rt>ä¸»<rt>ã„“ã„¨Ë‡</rt>æ©Ÿ<rt>ã„ã„§</rt></ruby>",
    "ç§‘å­¸å¯¦é©—å¥—çµ„": "<ruby>ç§‘<rt>ã„ã„œ</rt>å­¸<rt>ã„’ã„©ã„ËŠ</rt>å¯¦<rt>ã„•ËŠ</rt>é©—<rt>ã„§ã„¢Ë‹</rt>å¥—<rt>ã„Šã„ Ë‹</rt>çµ„<rt>ã„—ã„¨Ë‡</rt></ruby>",
    "ç›´æ’è¼ªé‹çµ„åˆ": "<ruby>ç›´<rt>ã„“ËŠ</rt>æ’<rt>ã„†ã„ËŠ</rt>è¼ª<rt>ã„Œã„¨ã„£ËŠ</rt>é‹<rt>ã„’ã„§ã„ËŠ</rt>çµ„<rt>ã„—ã„¨Ë‡</rt>åˆ<rt>ã„ã„œËŠ</rt></ruby>",
    "æ¨¡å‹æ±½è»Š": "<ruby>æ¨¡<rt>ã„‡ã„›ËŠ</rt>å‹<rt>ã„’ã„§ã„¥ËŠ</rt>æ±½<rt>ã„‘ã„§Ë‹</rt>è»Š<rt>ã„”ã„œ</rt></ruby>",
    "é›»å‹•ç«è»Šçµ„": "<ruby>é›»<rt>ã„‰ã„§ã„¢Ë‹</rt>å‹•<rt>ã„‰ã„¨ã„¥Ë‹</rt>ç«<rt>ã„ã„¨ã„›Ë‡</rt>è»Š<rt>ã„”ã„œ</rt>çµ„<rt>ã„—ã„¨Ë‡</rt></ruby>",
    "é‹¼ç´ç©å…·çµ„": "<ruby>é‹¼<rt>ã„ã„¤</rt>ç´<rt>ã„‘ã„§ã„£ËŠ</rt>ç©<rt>ã„¨ã„¢ËŠ</rt>å…·<rt>ã„ã„©Ë‹</rt>çµ„<rt>ã„—ã„¨Ë‡</rt></ruby>",
    "æˆ¶å¤–éœ²ç‡Ÿçµ„": "<ruby>æˆ¶<rt>ã„ã„¨Ë‹</rt>å¤–<rt>ã„¨ã„Ë‹</rt>éœ²<rt>ã„Œã„¨Ë‹</rt>ç‡Ÿ<rt>ã„§ã„¥ËŠ</rt>çµ„<rt>ã„—ã„¨Ë‡</rt></ruby>",
    "æ¡ŒéŠå¤§ç¦®åŒ…": "<ruby>æ¡Œ<rt>ã„“ã„¨ã„›</rt>éŠ<rt>ã„§ã„¡ËŠ</rt>å¤§<rt>ã„‰ã„šË‹</rt>ç¦®<rt>ã„Œã„§Ë‡</rt>åŒ…<rt>ã„…ã„ </rt></ruby>"
  };

  // ===== å·¥å…·ï¼šæ´—ç‰Œå‡½æ•¸ =====
  function shuffle(array) {
    const arr = array.slice();
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  // ===== é¡Œåº«è¨­å®šï¼ˆåŒå‰ä¸€ç‰ˆï¼Œç•¥ï¼‰ =====
  const questionsPool = [
    {
      price: 2321,
      name: "ç©æœ¨çµ„åˆ",
      emoji: "ğŸ§±",
      description: "2321 å…ƒçš„ç©æœ¨çµ„åˆ",
      options: [
        [{ denom: 1000, count: 2 }, { denom: 100, count: 3 }, { denom: 10, count: 2 }, { denom: 1, count: 1 }],
        [{ denom: 100, count: 23 }, { denom: 10, count: 2 }, { denom: 1, count: 1 }],
        [{ denom: 1000, count: 2 }, { denom: 10, count: 32 }, { denom: 1, count: 1 }],
        [{ denom: 1, count: 2321 }]
      ],
      correctIndex: 0
    },
    {
      price: 3152,
      name: "å°ç†Šç©å¶",
      emoji: "ğŸ§¸",
      description: "3152 å…ƒçš„å°ç†Šç©å¶",
      options: [
        [{ denom: 1000, count: 3 }, { denom: 100, count: 1 }, { denom: 10, count: 5 }, { denom: 1, count: 2 }],
        [{ denom: 100, count: 31 }, { denom: 1, count: 52 }],
        [{ denom: 1, count: 3152 }],
        [{ denom: 1000, count: 3 }, { denom: 10, count: 15 }, { denom: 1, count: 2 }]
      ],
      correctIndex: 0
    },
    {
      price: 4800,
      name: "é™æ§æ©Ÿå™¨äºº",
      emoji: "ğŸ¤–",
      description: "4800 å…ƒçš„é™æ§æ©Ÿå™¨äºº",
      options: [
        [{ denom: 1000, count: 4 }, { denom: 100, count: 8 }],
        [{ denom: 100, count: 48 }],
        [{ denom: 10, count: 480 }],
        [{ denom: 1000, count: 3 }, { denom: 100, count: 18 }]
      ],
      correctIndex: 0
    },
    {
      price: 9999,
      name: "é«˜éšéŠæˆ²ä¸»æ©Ÿ",
      emoji: "ğŸ®",
      description: "9999 å…ƒçš„é«˜éšéŠæˆ²ä¸»æ©Ÿ",
      options: [
        [{ denom: 1000, count: 9 }, { denom: 100, count: 9 }, { denom: 10, count: 9 }, { denom: 1, count: 9 }],
        [{ denom: 100, count: 99 }, { denom: 10, count: 9 }, { denom: 1, count: 9 }],
        [{ denom: 1000, count: 9 }, { denom: 10, count: 99 }, { denom: 1, count: 9 }],
        [{ denom: 1, count: 9999 }]
      ],
      correctIndex: 0
    },
    {
      price: 4276,
      name: "ç§‘å­¸å¯¦é©—å¥—çµ„",
      emoji: "ğŸ§ª",
      description: "4276 å…ƒçš„ç§‘å­¸å¯¦é©—å¥—çµ„",
      options: [
        [{ denom: 1000, count: 4 }, { denom: 100, count: 2 }, { denom: 10, count: 7 }, { denom: 1, count: 6 }],
        [{ denom: 100, count: 42 }, { denom: 10, count: 7 }, { denom: 1, count: 6 }],
        [{ denom: 1000, count: 4 }, { denom: 10, count: 27 }, { denom: 1, count: 6 }],
        [{ denom: 1, count: 4276 }]
      ],
      correctIndex: 0
    },
    {
      price: 6503,
      name: "ç›´æ’è¼ªé‹çµ„åˆ",
      emoji: "ğŸ›¼",
      description: "6503 å…ƒçš„ç›´æ’è¼ªé‹çµ„åˆ",
      options: [
        [{ denom: 1000, count: 6 }, { denom: 100, count: 5 }, { denom: 1, count: 3 }],
        [{ denom: 100, count: 65 }, { denom: 1, count: 3 }],
        [{ denom: 1000, count: 6 }, { denom: 10, count: 50 }, { denom: 1, count: 3 }],
        [{ denom: 1, count: 6503 }]
      ],
      correctIndex: 0
    },
    {
      price: 1234,
      name: "æ¨¡å‹æ±½è»Š",
      emoji: "ğŸš—",
      description: "1234 å…ƒçš„æ¨¡å‹æ±½è»Š",
      options: [
        [{ denom: 1000, count: 1 }, { denom: 100, count: 2 }, { denom: 10, count: 3 }, { denom: 1, count: 4 }],
        [{ denom: 100, count: 12 }, { denom: 10, count: 3 }, { denom: 1, count: 4 }],
        [{ denom: 1000, count: 1 }, { denom: 10, count: 23 }, { denom: 1, count: 4 }],
        [{ denom: 1, count: 1234 }]
      ],
      correctIndex: 0
    },
    {
      price: 5678,
      name: "é›»å‹•ç«è»Šçµ„",
      emoji: "ğŸš‚",
      description: "5678 å…ƒçš„é›»å‹•ç«è»Šçµ„",
      options: [
        [{ denom: 1000, count: 5 }, { denom: 100, count: 6 }, { denom: 10, count: 7 }, { denom: 1, count: 8 }],
        [{ denom: 100, count: 56 }, { denom: 10, count: 7 }, { denom: 1, count: 8 }],
        [{ denom: 1000, count: 5 }, { denom: 10, count: 67 }, { denom: 1, count: 8 }],
        [{ denom: 1, count: 5678 }]
      ],
      correctIndex: 0
    },
    {
      price: 7012,
      name: "é‹¼ç´ç©å…·çµ„",
      emoji: "ğŸ¹",
      description: "7012 å…ƒçš„é‹¼ç´ç©å…·çµ„",
      options: [
        [{ denom: 1000, count: 7 }, { denom: 10, count: 1 }, { denom: 1, count: 2 }],
        [{ denom: 100, count: 70 }, { denom: 10, count: 1 }, { denom: 1, count: 2 }],
        [{ denom: 1000, count: 7 }, { denom: 1, count: 12 }],
        [{ denom: 1, count: 7012 }]
      ],
      correctIndex: 0
    },
    {
      price: 8405,
      name: "æˆ¶å¤–éœ²ç‡Ÿçµ„",
      emoji: "â›º",
      description: "8405 å…ƒçš„æˆ¶å¤–éœ²ç‡Ÿçµ„",
      options: [
        [{ denom: 1000, count: 8 }, { denom: 100, count: 4 }, { denom: 1, count: 5 }],
        [{ denom: 100, count: 84 }, { denom: 1, count: 5 }],
        [{ denom: 1000, count: 8 }, { denom: 10, count: 40 }, { denom: 1, count: 5 }],
        [{ denom: 1, count: 8405 }]
      ],
      correctIndex: 0
    },
    {
      price: 3907,
      name: "æ¡ŒéŠå¤§ç¦®åŒ…",
      emoji: "ğŸ²",
      description: "3907 å…ƒçš„æ¡ŒéŠå¤§ç¦®åŒ…",
      options: [
        [{ denom: 1000, count: 3 }, { denom: 100, count: 9 }, { denom: 1, count: 7 }],
        [{ denom: 100, count: 39 }, { denom: 1, count: 7 }],
        [{ denom: 1000, count: 3 }, { denom: 10, count: 90 }, { denom: 1, count: 7 }],
        [{ denom: 1, count: 3907 }]
      ],
      correctIndex: 0
    }
  ];

  const QUESTIONS_PER_GAME = 4;

  // ===== DOM å…ƒä»¶ =====
  const questionNumberEl = document.getElementById("questionNumber");
  const priceDisplayEl = document.getElementById("priceDisplay");
  const productNameEl = document.getElementById("productName");
  const productEmojiEl = document.getElementById("productEmoji");
  const progressInfoEl = document.getElementById("progressInfo");
  const optionsGridEl = document.getElementById("optionsGrid");

  const feedbackOverlayEl = document.getElementById("feedbackOverlay");
  const feedbackIconEl = document.getElementById("feedbackIcon");
  const feedbackTextEl = document.getElementById("feedbackText");
  const feedbackSubTextEl = document.getElementById("feedbackSubText");

  const endScreenEl = document.getElementById("endScreen");
  const endTitleEl = document.getElementById("endTitle");
  const endSubtitleEl = document.getElementById("endSubtitle");
  const endScoreEl = document.getElementById("endScore");
  const restartBtn = document.getElementById("restartBtn");

  // ===== éŠæˆ²ç‹€æ…‹ =====
  let gameQuestions = [];
  let totalQuestions = 0;
  let currentIndex = 0;
  let correctCount = 0;
  let locked = false;

  function formatPrice(price) {
    return price.toString();
  }

  function setupNewGame() {
    const shuffledPool = shuffle(questionsPool);
    gameQuestions = shuffledPool.slice(0, Math.min(QUESTIONS_PER_GAME, shuffledPool.length));
    totalQuestions = gameQuestions.length;
    currentIndex = 0;
    correctCount = 0;
    locked = false;
    endScreenEl.classList.remove("visible");

    // è¨­å®šçµæŸç•«é¢å›ºå®šæ–‡å­—ã€æŒ‰éˆ•æ³¨éŸ³
    endTitleEl.innerHTML = RUBY.END_TITLE;
    endSubtitleEl.innerHTML = RUBY.END_SUBTITLE;
    restartBtn.innerHTML = RUBY.RESTART;

    renderQuestion();
  }

  function renderQuestion() {
    locked = false;
    feedbackOverlayEl.classList.remove("visible");

    const q = gameQuestions[currentIndex];

    // é¡Œè™Ÿ
    questionNumberEl.innerHTML =
      `${RUBY.DI} ${currentIndex + 1} ${RUBY.TI} / ${RUBY.GONG} ${totalQuestions} ${RUBY.TI}`;

    // åƒ¹æ ¼
    priceDisplayEl.innerHTML =
      `${formatPrice(q.price)}<span class="unit">${RUBY.YUAN}</span>`;

    // å•†å“åç¨±æ³¨éŸ³
    productNameEl.innerHTML = PRODUCT_RUBY[q.name] || q.name;

    // åœ–æ¡ˆ
    productEmojiEl.textContent = q.emoji;

    // é€²åº¦
    progressInfoEl.innerHTML =
      `${RUBY.PROG_PREFIX}${correctCount} ${RUBY.TI}`;

    // é¸é …
    const optionBundles = q.options.map((opt, idx) => ({
      option: opt,
      isCorrect: idx === q.correctIndex
    }));
    const shuffledOptions = shuffle(optionBundles);

    optionsGridEl.innerHTML = "";
    const letters = ["A", "B", "C", "D"];
    const denomOrder = [1000, 100, 10, 1];

    shuffledOptions.forEach((bundle, index) => {
      const card = document.createElement("div");
      card.className = "option-card";
      card.dataset.correct = bundle.isCorrect ? "1" : "0";

      const title = document.createElement("div");
      title.className = "option-title";
      title.innerHTML = `${RUBY.PAY_LABEL} ${letters[index]}`;
      card.appendChild(title);

      const body = document.createElement("div");
      body.className = "option-body";

      // æ¯å€‹é¸é …å›ºå®šé¡¯ç¤ºå››ç¨®é¢é¡ï¼Œæ²’æœ‰çš„å°± Ã—0
      denomOrder.forEach(denom => {
        const found = bundle.option.find(row => row.denom === denom);
        const count = found ? found.count : 0;

        const line = document.createElement("div");
        line.className = "money-line";

        const note = document.createElement("div");
        note.className = "note-icon";

        if (denom === 1000) note.classList.add("note-1000");
        else if (denom === 100) note.classList.add("note-100");
        else if (denom === 10) note.classList.add("note-10");
        else if (denom === 1) note.classList.add("note-1");

        note.textContent = `${denom} å…ƒ`;
        line.appendChild(note);

        const multi = document.createElement("div");
        multi.className = "note-multiplier";
        multi.innerHTML = `Ã— <strong>${count}</strong>`;
        line.appendChild(multi);

        body.appendChild(line);
      });

      card.appendChild(body);
      card.addEventListener("click", () => handleOptionClick(card));
      optionsGridEl.appendChild(card);
    });
  }

  // ===== å°éŸ³æ•ˆï¼šç­”å° / ç­”éŒ¯ =====
  function playSound(isCorrect) {
    try {
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      if (!AudioContext) return;

      const ctx = new AudioContext();
      const now = ctx.currentTime;

      function tone(freq, startOffset, duration) {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = "sine";
        osc.frequency.value = freq;
        osc.connect(gain);
        gain.connect(ctx.destination);

        const start = now + startOffset;
        gain.gain.setValueAtTime(0.0001, start);
        gain.gain.exponentialRampToValueAtTime(0.2, start + 0.02);
        gain.gain.exponentialRampToValueAtTime(0.0001, start + duration);

        osc.start(start);
        osc.stop(start + duration + 0.05);
      }

      if (isCorrect) {
        tone(800, 0, 0.12);
        tone(1000, 0.16, 0.12);
      } else {
        tone(380, 0, 0.16);
        tone(260, 0.18, 0.18);
      }

      setTimeout(() => ctx.close(), 600);
    } catch (e) {
      // ignore
    }
  }

  function handleOptionClick(cardEl) {
    if (locked) return;

    const isCorrect = cardEl.dataset.correct === "1";
    locked = true;
    showFeedback(isCorrect);

    const cards = optionsGridEl.querySelectorAll(".option-card");
    cards.forEach(card => card.classList.add("disabled"));

    if (isCorrect) {
      correctCount++;
    }

    setTimeout(() => {
      if (currentIndex < totalQuestions - 1) {
        currentIndex++;
        renderQuestion();
      } else {
        showEndScreen();
      }
    }, 1200);
  }

  function showFeedback(isCorrect) {
    feedbackIconEl.textContent = isCorrect ? "âœ“" : "âœ—";
    feedbackIconEl.style.color = isCorrect ? "#16a34a" : "#dc2626";
    feedbackTextEl.innerHTML = isCorrect ? RUBY.ANSWER_OK : RUBY.ANSWER_BAD;

    if (isCorrect) {
      feedbackSubTextEl.innerHTML =
        currentIndex < totalQuestions - 1 ? RUBY.SUB_NEXT : RUBY.SUB_RESULT;
    } else {
      feedbackSubTextEl.innerHTML = RUBY.SUB_WRONG;
    }

    feedbackOverlayEl.classList.add("visible");
    playSound(isCorrect);
  }

  function showEndScreen() {
    feedbackOverlayEl.classList.remove("visible");

    // ä¾‹å¦‚ï¼šã€Œå…± 4 é¡Œï¼Œä½ ç­”å°äº† 3 é¡Œã€‚ã€
    endScoreEl.innerHTML =
      `${RUBY.GONG} ${totalQuestions} ${RUBY.TI}${RUBY.END_SCORE_MID} ${correctCount} ${RUBY.END_SCORE_TAIL}`;

    endScreenEl.classList.add("visible");
  }

  function restartGame() {
    setupNewGame();
  }

  restartBtn.addEventListener("click", restartGame);

  // åˆå§‹åŒ–
  setupNewGame();
</script>
</body>
</html>
